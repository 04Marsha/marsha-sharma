<div class="loader" *ngIf="isLoading">
  <app-loader />
</div>

<div class="rate-section" *ngIf="!isLoading">
  <a class="back-button" routerLink="/">
    <i class="fas fa-arrow-left"></i>
  </a>

  <div class="rate-form-section">
    <h2>Rate my profile</h2>
    <form
      (ngSubmit)="submitFeedback(feedbackForm)"
      class="feedback-form"
      #feedbackForm="ngForm"
    >
      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="feedbackData.email"
          required
          email
          #email="ngModel"
        />
        <div
          *ngIf="email.invalid && (email.dirty || email.touched)"
          class="error-message"
        >
          * Please enter a valid email.
        </div>
      </div>

      <div
        class="rating-holder"
        [ngClass]="{ invalid: formStatus === 'error' && rating === 0 }"
      >
        <div class="rating-line">
          <h3>How many stars does my profile deserve?</h3>
        </div>
        <div class="rating">
          <span
            *ngFor="let star of stars; let i = index"
            class="star"
            [class.active]="i < rating"
            (click)="setRating(i + 1)"
            >&#9733;</span
          >
        </div>
      </div>

      <div class="form-group">
        <div class="center">
          <img src="assets/rating-util/note.png" alt="note" />
          <label for="message"
            >I&apos;m always learning <br />
            Let me know what you liked or where I can improve.</label
          >
        </div>
        <textarea
          id="message"
          name="message"
          rows="6"
          [(ngModel)]="feedbackData.note"
          #message="ngModel"
        ></textarea>
      </div>

      <button type="submit" [disabled]="!feedbackForm.form.valid || rating === 0">
        Send Message
      </button>

      <div
        *ngIf="formStatus"
        [ngClass]="{
          success: formStatus === 'success',
          error: formStatus === 'error'
        }"
        class="form-status-message"
      >
        <ng-container *ngIf="formStatus === 'success'">
          🥳 Thanks for the feedback! You&apos;re officially awesome.
        </ng-container>
        <ng-container *ngIf="formStatus === 'error'">
          😵‍💫 Oops! My inbox just tripped over a wire 💔. Please try again 🥹
        </ng-container>
      </div>
    </form>
  </div>
</div>
